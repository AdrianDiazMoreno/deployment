# vim: set ft=sh sw=2 ts=8 et :
deploy_wmcore_auth_variants="default prod preprod"
deploy_wmcore_auth_prep()
{
  mkproj -l -s
}

deploy_wmcore_auth_sw()
{
  [ X"$privauthdir" = X ] || rm -f $project_auth/header-auth-key
  deploy_pkg -a wmcore-auth/header-auth-key
}

deploy_wmcore_auth_auth()
{
  if [ X"$privauthdir" = X ] || [ $(ls $privauthdir/wmcore/*-key* 2>/dev/null | wc -l) = 0 ]; then
    havekeys=false
  else
    havekeys=true
  fi

  case $variant:$havekeys in
    prod:true | preprod:true )
      cat $privauthdir/wmcore/header-auth-key-$variant ;;
    * )
      perl -e 'open(R, "< /dev/urandom") or die; sysread(R, $key, 20) or die; print $key' ;;
  esac
}

deploy_wmcore_auth_post()
{
  disable
}
